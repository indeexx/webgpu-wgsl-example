var B=Object.defineProperty;var P=(r,e,s)=>e in r?B(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var t=(r,e,s)=>(P(r,typeof e!="symbol"?e+"":e,s),s);import{_ as V,R as T}from"./vendor.5b22622a.js";const U="_part_pfhqm_1",R="_card_pfhqm_1",D="_footer_pfhqm_4";var M={part:U,card:R,footer:D},S=`@stage(vertex)
fn main(@builtin(vertex_index) VertexIndex : u32)
     -> @builtin(position) vec4<f32> {
  var pos = array<vec2<f32>, 3>(
      vec2<f32>(0.0, 0.5),
      vec2<f32>(-0.5, -0.5),
      vec2<f32>(0.5, -0.5));

  return vec4<f32>(pos[VertexIndex], 0.0, 1.0);
}`,N=`@stage(fragment)
fn main() -> @location(0) vec4<f32> {
  return vec4<f32>(0.0, 1.0, 0.0, 1.0);
}`;const q=new Float32Array([1,-1,0,-1,-1,0,0,1,0]),z=new Float32Array([1,0,0,0,1,0,0,0,1]),G=new Uint16Array([0,1,2]);class I{constructor(e){t(this,"canvas");t(this,"adapter");t(this,"device");t(this,"queue");t(this,"context");t(this,"colorTexture");t(this,"colorTextureView");t(this,"depthTexture");t(this,"depthTextureView");t(this,"positionBuffer");t(this,"colorBuffer");t(this,"indexBuffer");t(this,"vertModule");t(this,"fragModule");t(this,"pipeline");t(this,"commandEncoder");t(this,"passEncoder");t(this,"tempCW",0);t(this,"tempCH",0);t(this,"render",()=>{var e,s;this.depthTexture&&this.tempCW!=this.canvas.width&&this.tempCH!=this.canvas.height&&(this.depthTexture.destroy(),this.start()),this.colorTexture=(e=this.context)==null?void 0:e.getCurrentTexture(),this.colorTextureView=(s=this.colorTexture)==null?void 0:s.createView(),this.encodeCommands(),requestAnimationFrame(this.render)});this.canvas=e,this.tempCW=this.canvas.width,this.tempCH=this.canvas.height}async start(){await this.initializeAPI()&&(this.resizeBackings(),await this.initializeResources(),this.render())}async initializeAPI(){var e;try{const s=navigator.gpu;if(!s)return console.log("not support!"),!1;this.adapter=await s.requestAdapter(),this.device=await this.adapter.requestDevice(),this.queue=(e=this.device)==null?void 0:e.queue}catch(s){return console.error(s),!1}return!0}async initializeResources(){var o,E,b,y;const e=(w,A)=>{let C={size:w.byteLength+3&-4,usage:A,mappedAtCreation:!0},v=this.device.createBuffer(C);return(w instanceof Uint16Array?new Uint16Array(v.getMappedRange()):new Float32Array(v.getMappedRange())).set(w),v.unmap(),v};this.positionBuffer=e(q,GPUBufferUsage.VERTEX),this.colorBuffer=e(z,GPUBufferUsage.VERTEX),this.indexBuffer=e(G,GPUBufferUsage.INDEX);const s={code:S};this.vertModule=(o=this.device)==null?void 0:o.createShaderModule(s);const n={code:N};this.fragModule=(E=this.device)==null?void 0:E.createShaderModule(n);const i={shaderLocation:0,offset:0,format:"float32x3"},a={shaderLocation:1,offset:0,format:"float32x3"},c={attributes:[i],arrayStride:4*3,stepMode:"vertex"},d={attributes:[a],arrayStride:4*3,stepMode:"vertex"},h={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},u={bindGroupLayouts:[]},l=(b=this.device)==null?void 0:b.createPipelineLayout(u),p={module:this.vertModule,entryPoint:"main",buffers:[c,d]},f={format:"bgra8unorm"},m={module:this.fragModule,entryPoint:"main",targets:[f]},g={layout:l,vertex:p,fragment:m,primitive:{frontFace:"cw",cullMode:"none",topology:"triangle-list"},depthStencil:h};this.pipeline=(y=this.device)==null?void 0:y.createRenderPipeline(g)}resizeBackings(){var s,n,i;if(!this.context){this.context=this.canvas.getContext("webgpu");const a={device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC};(s=this.context)==null||s.configure(a)}const e={size:[this.canvas.width,this.canvas.height,1],dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC};this.depthTexture=(n=this.device)==null?void 0:n.createTexture(e),this.depthTextureView=(i=this.depthTexture)==null?void 0:i.createView()}encodeCommands(){var i,a,c,d,h,u,l,p,f,m,x,g,o;let e={view:this.colorTextureView,clearValue:{r:0,g:0,b:0,a:1},loadValue:{r:0,g:0,b:0,a:1},storeOp:"store",loadOp:"clear"};const s={view:this.depthTextureView,depthLoadValue:1,depthStoreOp:"store",stencilClearValue:0,stencilStoreOp:"store",stencilLoadValue:0,clearValue:{r:0,g:0,b:0,a:1},loadValue:{r:0,g:0,b:0,a:1}},n={colorAttachments:[e],depthStencilAttachment:s};this.commandEncoder=(i=this.device)==null?void 0:i.createCommandEncoder(),this.passEncoder=(a=this.commandEncoder)==null?void 0:a.beginRenderPass(n),(c=this.passEncoder)==null||c.setPipeline(this.pipeline),(d=this.passEncoder)==null||d.setViewport(0,0,this.canvas.width,this.canvas.height,0,1),(h=this.passEncoder)==null||h.setScissorRect(0,0,this.canvas.width,this.canvas.height),(u=this.passEncoder)==null||u.setVertexBuffer(0,this.positionBuffer),(l=this.passEncoder)==null||l.setVertexBuffer(1,this.colorBuffer),(p=this.passEncoder)==null||p.setIndexBuffer(this.indexBuffer,"uint16"),(f=this.passEncoder)==null||f.drawIndexed(3,1),(m=this.passEncoder)!=null&&m.endPass?(x=this.passEncoder)==null||x.endPass():(g=this.passEncoder)==null||g.end(),(o=this.queue)==null||o.submit([this.commandEncoder.finish()])}}var _="/Users/indeex/Documents/program/indeex/program/webGPU/wgsl-base/src/component/part3/index.tsx";const O=()=>(V.exports.useEffect(()=>{const r=document.getElementById("gfx");r.width=document.body.clientWidth,r.height=document.body.clientHeight,new I(r).start(),window.onresize=function(){r.width=document.body.clientWidth,r.height=document.body.clientHeight}}),T.createElement("div",{className:M.part,__self:globalThis,__source:{fileName:_,lineNumber:17,columnNumber:10}},T.createElement("canvas",{id:"gfx",__self:globalThis,__source:{fileName:_,lineNumber:18,columnNumber:5}})));export{O as default};
