var B=Object.defineProperty;var C=(r,e,t)=>e in r?B(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>(C(r,typeof e!="symbol"?e+"":e,t),t);import{_ as U,R as y}from"./vendor.5b22622a.js";const V="_part_pfhqm_1",R="_card_pfhqm_1",S="_footer_pfhqm_4";var D={part:V,card:R,footer:S},M=`struct VSOut {
    [[builtin(position)]] Position: vec4<f32>;
    [[location(0)]] color: vec3<f32>;
};

[[stage(vertex)]]
fn main([[location(0)]] inPos: vec3<f32>,
        [[location(1)]] inColor: vec3<f32>) -> VSOut {
    var vsOut: VSOut;
    vsOut.Position = vec4<f32>(inPos, 1.0);
    vsOut.color = inColor;
    return vsOut;
}`,N=`[[stage(fragment)]]
fn main([[location(0)]] inColor: vec3<f32>) -> [[location(0)]] vec4<f32> {
    return vec4<f32>(inColor, 1.0);
}`;const O=new Float32Array([1,-1,0,-1,-1,0,0,1,0]),q=new Float32Array([1,0,0,0,1,0,0,0,1]),G=new Uint16Array([0,1,2]);class z{constructor(e){s(this,"canvas");s(this,"adapter");s(this,"device");s(this,"queue");s(this,"context");s(this,"colorTexture");s(this,"colorTextureView");s(this,"depthTexture");s(this,"depthTextureView");s(this,"positionBuffer");s(this,"colorBuffer");s(this,"indexBuffer");s(this,"vertModule");s(this,"fragModule");s(this,"pipeline");s(this,"commandEncoder");s(this,"passEncoder");s(this,"render",()=>{var e,t;this.colorTexture=(e=this.context)==null?void 0:e.getCurrentTexture(),this.colorTextureView=(t=this.colorTexture)==null?void 0:t.createView(),this.encodeCommands(),requestAnimationFrame(this.render)});this.canvas=e}async start(){await this.initializeAPI()&&(this.resizeBackings(),await this.initializeResources(),this.render())}async initializeAPI(){var e;try{const t=navigator.gpu;if(!t)return console.log("not support!"),!1;this.adapter=await t.requestAdapter(),this.device=await this.adapter.requestDevice(),this.queue=(e=this.device)==null?void 0:e.queue}catch(t){return console.error(t),!1}return!0}async initializeResources(){var a,w,T,_;const e=(E,P)=>{let A={size:E.byteLength+3&-4,usage:P,mappedAtCreation:!0},g=this.device.createBuffer(A);return(E instanceof Uint16Array?new Uint16Array(g.getMappedRange()):new Float32Array(g.getMappedRange())).set(E),g.unmap(),g};this.positionBuffer=e(O,GPUBufferUsage.VERTEX),this.colorBuffer=e(q,GPUBufferUsage.VERTEX),this.indexBuffer=e(G,GPUBufferUsage.INDEX);const t={code:M};this.vertModule=(a=this.device)==null?void 0:a.createShaderModule(t);const o={code:N};this.fragModule=(w=this.device)==null?void 0:w.createShaderModule(o);const i={shaderLocation:0,offset:0,format:"float32x3"},n={shaderLocation:1,offset:0,format:"float32x3"},c={attributes:[i],arrayStride:4*3,stepMode:"vertex"},d={attributes:[n],arrayStride:4*3,stepMode:"vertex"},u={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},h={bindGroupLayouts:[]},l=(T=this.device)==null?void 0:T.createPipelineLayout(h),f={module:this.vertModule,entryPoint:"main",buffers:[c,d]},p={format:"bgra8unorm"},m={module:this.fragModule,entryPoint:"main",targets:[p]},v={layout:l,vertex:f,fragment:m,primitive:{frontFace:"cw",cullMode:"none",topology:"triangle-list"},depthStencil:u};this.pipeline=(_=this.device)==null?void 0:_.createRenderPipeline(v)}resizeBackings(){var t,o,i;if(!this.context){this.context=this.canvas.getContext("webgpu");const n={device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC};(t=this.context)==null||t.configure(n)}const e={size:[this.canvas.width,this.canvas.height,1],dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC};this.depthTexture=(o=this.device)==null?void 0:o.createTexture(e),this.depthTextureView=(i=this.depthTexture)==null?void 0:i.createView()}encodeCommands(){var i,n,c,d,u,h,l,f,p,m,x,v,a;let e={view:this.colorTextureView,loadValue:{r:0,g:0,b:0,a:1},storeOp:"store"};const t={view:this.depthTextureView,depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:"load",stencilStoreOp:"store"},o={colorAttachments:[e],depthStencilAttachment:t};this.commandEncoder=(i=this.device)==null?void 0:i.createCommandEncoder(),this.passEncoder=(n=this.commandEncoder)==null?void 0:n.beginRenderPass(o),(c=this.passEncoder)==null||c.setPipeline(this.pipeline),(d=this.passEncoder)==null||d.setViewport(0,0,this.canvas.width,this.canvas.height,0,1),(u=this.passEncoder)==null||u.setScissorRect(0,0,this.canvas.width,this.canvas.height),(h=this.passEncoder)==null||h.setVertexBuffer(0,this.positionBuffer),(l=this.passEncoder)==null||l.setVertexBuffer(1,this.colorBuffer),(f=this.passEncoder)==null||f.setIndexBuffer(this.indexBuffer,"uint16"),(p=this.passEncoder)==null||p.drawIndexed(3,1),(m=this.passEncoder)!=null&&m.endPass?(x=this.passEncoder)==null||x.endPass():(v=this.passEncoder)==null||v.end(),(a=this.queue)==null||a.submit([this.commandEncoder.finish()])}}var b="/Users/indeex/Documents/program/indeex/program/webGPU/wgsl-base/src/component/part1/index.tsx";const H=()=>(U.exports.useEffect(()=>{const r=document.getElementById("gfx");r.width=document.body.clientWidth,r.height=document.body.clientHeight,new z(r).start()}),y.createElement("div",{className:D.part,__self:globalThis,__source:{fileName:b,lineNumber:13,columnNumber:10}},y.createElement("canvas",{id:"gfx",__self:globalThis,__source:{fileName:b,lineNumber:14,columnNumber:5}})));export{H as default};
