var G=Object.defineProperty;var U=(r,t,e)=>t in r?G(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var i=(r,t,e)=>(U(r,typeof t!="symbol"?t+"":t,e),e);import{U as h,_ as D,R as w}from"./vendor.5b22622a.js";/* empty css              */import{c as u,p as A,t as m,f,r as P,m as d}from"./vec3.d4a804b7.js";const C="_part_pfhqm_1",T="_card_pfhqm_1",z="_footer_pfhqm_4";var R={part:C,card:T,footer:z},O=`struct Uniforms {
  modelViewProjectionMatrix : mat4x4<f32>;
};
@binding(0) @group(0) var<uniform> uniforms : Uniforms;

struct VertexOutput {
  @builtin(position) Position : vec4<f32>;
  @location(0) fragUV : vec2<f32>;
  @location(1) fragPosition: vec4<f32>;
};

@stage(vertex)
fn main(@location(0) position : vec4<f32>,
        @location(1) uv : vec2<f32>) -> VertexOutput {
  var output : VertexOutput;
  output.Position = uniforms.modelViewProjectionMatrix * position;
  output.fragUV = uv;
  output.fragPosition = 0.5 * (position + vec4<f32>(1.0, 1.0, 1.0, 1.0));
  return output;
}`,S=`@stage(fragment)
fn main(@location(0) fragUV: vec2<f32>,
        @location(1) fragPosition: vec4<f32>) -> @location(0) vec4<f32> {
  return fragPosition;
}`;const N=4*10,F=0,q=4*8,B=36,b=new Float32Array([1,-1,1,1,1,0,1,1,1,1,-1,-1,1,1,0,0,1,1,0,1,-1,-1,-1,1,0,0,0,1,0,0,1,-1,-1,1,1,0,0,1,1,0,1,-1,1,1,1,0,1,1,1,1,-1,-1,-1,1,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,0,1,1,0,1,1,-1,-1,1,1,0,0,1,0,0,1,1,-1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,0,0,1,0,0,-1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,-1,1,1,1,0,1,0,0,-1,1,-1,1,0,1,0,1,1,0,-1,1,1,1,0,1,1,1,1,1,1,1,-1,1,1,1,0,1,0,0,-1,-1,1,1,0,0,1,1,1,1,-1,1,1,1,0,1,1,1,0,1,-1,1,-1,1,0,1,0,1,0,0,-1,-1,-1,1,0,0,0,1,1,0,-1,-1,1,1,0,0,1,1,1,1,-1,1,-1,1,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,0,1,1,1,0,1,-1,-1,1,1,0,0,1,1,0,0,-1,-1,1,1,0,0,1,1,0,0,1,-1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,0,0,1,1,1,-1,-1,-1,1,0,0,0,1,0,1,-1,1,-1,1,0,1,0,1,0,0,1,1,-1,1,1,1,0,1,1,0,1,-1,-1,1,1,0,0,1,1,1,-1,1,-1,1,0,1,0,1,0,0]);class L{constructor(t){i(this,"adapter");i(this,"device");i(this,"context");i(this,"format");i(this,"devicePixelRatio",window.devicePixelRatio|1);i(this,"size",[0,0]);i(this,"uniformBuffer");i(this,"renderPassDescriptor");i(this,"pipeline");i(this,"uniformBindGroup");i(this,"uniformBindGroup2");i(this,"verticesBuffer");i(this,"projectionMatrix");i(this,"modelMatrix");i(this,"modelMatrix2");i(this,"modelViewProjectionMatrix");i(this,"modelViewProjectionMatrix2");i(this,"tmpMat4");i(this,"tmpMat42");i(this,"viewMatrix");i(this,"render",()=>{var n,a,o,c,s;this.updateTransfromationMatrix(),(n=this.device)==null||n.queue.writeBuffer(this.uniformBuffer,0,this.modelViewProjectionMatrix.buffer,this.modelViewProjectionMatrix.byteOffset,this.modelViewProjectionMatrix.byteLength),(a=this.device)==null||a.queue.writeBuffer(this.uniformBuffer,256,this.modelViewProjectionMatrix2.buffer,this.modelViewProjectionMatrix2.byteOffset,this.modelViewProjectionMatrix2.byteLength),this.renderPassDescriptor.colorAttachments[0].view=(o=this.context)==null?void 0:o.getCurrentTexture().createView();const t=(c=this.device)==null?void 0:c.createCommandEncoder(),e=t==null?void 0:t.beginRenderPass(this.renderPassDescriptor);e==null||e.setPipeline(this.pipeline),e==null||e.setVertexBuffer(0,this.verticesBuffer),e==null||e.setBindGroup(0,this.uniformBindGroup),e==null||e.draw(B,1,0,0),e==null||e.setBindGroup(0,this.uniformBindGroup2),e==null||e.draw(B,1,0,0),e==null||e.end(),(s=this.device)==null||s.queue.submit([t.finish()]),requestAnimationFrame(this.render)});this.canvas=t,this.canvas=t;let e=t.clientWidth*this.devicePixelRatio,n=t.clientHeight*this.devicePixelRatio;this.size=[e,n]}async start(){var t,e;if(!this.canvas)throw h.error("\u6CA1\u6709Canvas Element",10),new Error("\u6CA1\u6709Canvas Element");if(!navigator.gpu)throw h.error("\u4E0D\u652F\u6301\u4F7F\u7528\u663E\u5361\u8BBE\u5907",10),new Error("\u4E0D\u652F\u6301\u663E\u5361\u8BBE\u5907");if(this.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"})||void 0,!this.adapter)throw h.error("\u83B7\u53D6\u663E\u5361\u8BBE\u5907\u5931\u8D25",10),new Error("\u83B7\u53D6\u663E\u5361\u8BBE\u5907\u5931\u8D25");if(this.device=await this.adapter.requestDevice(),!this.device)throw h.error("\u663E\u5361\u8BBE\u5907\u672A\u627E\u5230",10),new Error("\u663E\u5361\u8BBE\u5907\u672A\u627E\u5230");this.context=this.canvas.getContext("webgpu"),this.format=(t=this.context)==null?void 0:t.getPreferredFormat(this.adapter),(e=this.context)==null||e.configure({device:this.device,format:this.format,size:this.size}),await this.init()}async init(){var p,x,v,M,g;const t=(p=this.device)==null?void 0:p.createBuffer({size:b.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});new Float32Array(t.getMappedRange()).set(b),t==null||t.unmap(),this.verticesBuffer=t;const e=(x=this.device)==null?void 0:x.createRenderPipeline({vertex:{module:this.device.createShaderModule({code:O}),entryPoint:"main",buffers:[{arrayStride:N,attributes:[{shaderLocation:0,offset:F,format:"float32x4"},{shaderLocation:1,offset:q,format:"float32x2"}]}]},fragment:{module:this.device.createShaderModule({code:S}),entryPoint:"main",targets:[{format:this.format}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}});this.pipeline=e;const n=(v=this.device)==null?void 0:v.createTexture({size:this.size,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),a=4*16,o=256,c=o+a,s=this.device.createBuffer({size:c,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.uniformBuffer=s;const j=(M=this.device)==null?void 0:M.createBindGroup({layout:e.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:s,offset:0,size:a}}]});this.uniformBindGroup=j;const _=(g=this.device)==null?void 0:g.createBindGroup({layout:e.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:s,offset:o,size:a}}]});this.uniformBindGroup2=_;const y={colorAttachments:[{view:void 0,loadValue:{r:.5,g:.5,b:.5,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:n.createView(),depthClearValue:1,depthStoreOp:"store",depthLoadOp:"clear"}};this.renderPassDescriptor=y;const l=u();this.projectionMatrix=l;const E=this.canvas.clientWidth/this.canvas.clientHeight;A(l,2*Math.PI/5,E,1,100),this.getTransformationMatrix(),this.render()}getTransformationMatrix(){const t=u();m(t,t,f(-2,0,0)),this.modelMatrix=t;const e=u();m(e,e,f(2,0,0)),this.modelMatrix2=e;const n=u();this.modelViewProjectionMatrix=n;const a=u();this.modelViewProjectionMatrix2=a;const o=u();m(o,o,f(0,0,-7)),this.viewMatrix=o;const c=u(),s=u();this.tmpMat4=c,this.tmpMat42=s}updateTransfromationMatrix(){const t=Date.now()/1e3;P(this.tmpMat4,this.modelMatrix,1,f(Math.sin(t),Math.cos(t),0)),P(this.tmpMat42,this.modelMatrix2,1,f(Math.cos(t),Math.sin(t),0)),d(this.modelViewProjectionMatrix,this.viewMatrix,this.tmpMat4),d(this.modelViewProjectionMatrix,this.projectionMatrix,this.modelViewProjectionMatrix),d(this.modelViewProjectionMatrix2,this.viewMatrix,this.tmpMat42),d(this.modelViewProjectionMatrix2,this.projectionMatrix,this.modelViewProjectionMatrix2)}}var V="/Users/indeex/Documents/program/indeex/program/webGPU/wgsl-base/src/component/part6/index.tsx";const X=()=>(D.exports.useEffect(()=>{const r=document.getElementById("gfx");r.width=document.body.clientWidth,r.height=document.body.clientHeight,new L(r).start(),window.onresize=function(){r.width=document.body.clientWidth,r.height=document.body.clientHeight}}),w.createElement("div",{className:R.part,__self:globalThis,__source:{fileName:V,lineNumber:17,columnNumber:10}},w.createElement("canvas",{id:"gfx",__self:globalThis,__source:{fileName:V,lineNumber:18,columnNumber:5}})));export{X as default};
