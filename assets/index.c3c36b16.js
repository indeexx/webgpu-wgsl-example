var C=Object.defineProperty;var P=(r,e,s)=>e in r?C(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var t=(r,e,s)=>(P(r,typeof e!="symbol"?e+"":e,s),s);import{_ as U,R as T}from"./vendor.5b22622a.js";const R="_part_pfhqm_1",V="_card_pfhqm_1",D="_footer_pfhqm_4";var M={part:R,card:V,footer:D},S=`@stage(vertex)
fn main(@builtin(vertex_index) VertexIndex : u32)
     -> @builtin(position) vec4<f32> {
  var pos = array<vec2<f32>, 3>(
      vec2<f32>(0.0, 0.5),
      vec2<f32>(-0.5, -0.5),
      vec2<f32>(0.5, -0.5));

  return vec4<f32>(pos[VertexIndex], 0.0, 1.0);
}`,N=`@stage(fragment)
fn main() -> @location(0) vec4<f32> {
  return vec4<f32>(0.0, 1.0, 0.0, 1.0);
}`;const q=new Float32Array([1,-1,0,-1,-1,0,0,1,0]),z=new Float32Array([1,0,0,0,1,0,0,0,1]),G=new Uint16Array([0,1,2]);class I{constructor(e){t(this,"canvas");t(this,"adapter");t(this,"device");t(this,"queue");t(this,"context");t(this,"colorTexture");t(this,"colorTextureView");t(this,"depthTexture");t(this,"depthTextureView");t(this,"positionBuffer");t(this,"colorBuffer");t(this,"indexBuffer");t(this,"vertModule");t(this,"fragModule");t(this,"pipeline");t(this,"commandEncoder");t(this,"passEncoder");t(this,"tempCW",0);t(this,"tempCH",0);t(this,"render",()=>{var e,s;this.depthTexture&&this.tempCW!=this.canvas.width&&this.tempCH!=this.canvas.height&&(this.depthTexture.destroy(),this.start()),this.colorTexture=(e=this.context)==null?void 0:e.getCurrentTexture(),this.colorTextureView=(s=this.colorTexture)==null?void 0:s.createView(),this.encodeCommands(),requestAnimationFrame(this.render)});this.canvas=e,this.tempCW=this.canvas.width,this.tempCH=this.canvas.height}async start(){await this.initializeAPI()&&(this.resizeBackings(),await this.initializeResources(),this.render())}async initializeAPI(){var e;try{const s=navigator.gpu;if(!s)return console.log("not support!"),!1;this.adapter=await s.requestAdapter(),this.device=await this.adapter.requestDevice(),this.queue=(e=this.device)==null?void 0:e.queue}catch(s){return console.error(s),!1}return!0}async initializeResources(){var x,w,y,E;const e=(g,A)=>{let B={size:g.byteLength+3&-4,usage:A,mappedAtCreation:!0},m=this.device.createBuffer(B);return(g instanceof Uint16Array?new Uint16Array(m.getMappedRange()):new Float32Array(m.getMappedRange())).set(g),m.unmap(),m};this.positionBuffer=e(q,GPUBufferUsage.VERTEX),this.colorBuffer=e(z,GPUBufferUsage.VERTEX),this.indexBuffer=e(G,GPUBufferUsage.INDEX);const s={code:S};this.vertModule=(x=this.device)==null?void 0:x.createShaderModule(s);const n={code:N};this.fragModule=(w=this.device)==null?void 0:w.createShaderModule(n);const i={shaderLocation:0,offset:0,format:"float32x3"},o={shaderLocation:1,offset:0,format:"float32x3"},a={attributes:[i],arrayStride:4*3,stepMode:"vertex"},c={attributes:[o],arrayStride:4*3,stepMode:"vertex"},d={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},h={bindGroupLayouts:[]},u=(y=this.device)==null?void 0:y.createPipelineLayout(h),f={module:this.vertModule,entryPoint:"main",buffers:[a,c]},l={format:"bgra8unorm"},p={module:this.fragModule,entryPoint:"main",targets:[l]},_={layout:u,vertex:f,fragment:p,primitive:{frontFace:"cw",cullMode:"none",topology:"triangle-list"},depthStencil:d};this.pipeline=(E=this.device)==null?void 0:E.createRenderPipeline(_)}resizeBackings(){var s,n,i;if(!this.context){this.context=this.canvas.getContext("webgpu");const o={device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC};(s=this.context)==null||s.configure(o)}const e={size:[this.canvas.width,this.canvas.height,1],dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC};this.depthTexture=(n=this.device)==null?void 0:n.createTexture(e),this.depthTextureView=(i=this.depthTexture)==null?void 0:i.createView()}encodeCommands(){var i,o,a,c,d,h,u,f,l,p,v;let e={view:this.colorTextureView,loadValue:{r:0,g:0,b:0,a:1},storeOp:"store"};const s={view:this.depthTextureView,depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:"load",stencilStoreOp:"store"},n={colorAttachments:[e],depthStencilAttachment:s};this.commandEncoder=(i=this.device)==null?void 0:i.createCommandEncoder(),this.passEncoder=(o=this.commandEncoder)==null?void 0:o.beginRenderPass(n),(a=this.passEncoder)==null||a.setPipeline(this.pipeline),(c=this.passEncoder)==null||c.setViewport(0,0,this.canvas.width,this.canvas.height,0,1),(d=this.passEncoder)==null||d.setScissorRect(0,0,this.canvas.width,this.canvas.height),(h=this.passEncoder)==null||h.setVertexBuffer(0,this.positionBuffer),(u=this.passEncoder)==null||u.setVertexBuffer(1,this.colorBuffer),(f=this.passEncoder)==null||f.setIndexBuffer(this.indexBuffer,"uint16"),(l=this.passEncoder)==null||l.drawIndexed(3,1),(p=this.passEncoder)==null||p.endPass(),(v=this.queue)==null||v.submit([this.commandEncoder.finish()])}}var b="/Users/indeex/Documents/program/indeex/program/webGPU/wgsl-base/src/component/part3/index.tsx";const W=()=>(U.exports.useEffect(()=>{const r=document.getElementById("gfx");r.width=document.body.clientWidth,r.height=document.body.clientHeight,new I(r).start(),window.onresize=function(){r.width=document.body.clientWidth,r.height=document.body.clientHeight}}),T.createElement("div",{className:M.part,__self:globalThis,__source:{fileName:b,lineNumber:17,columnNumber:10}},T.createElement("canvas",{id:"gfx",__self:globalThis,__source:{fileName:b,lineNumber:18,columnNumber:5}})));export{W as default};
