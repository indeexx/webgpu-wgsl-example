var j=Object.defineProperty;var M=(n,e,i)=>e in n?j(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var s=(n,e,i)=>(M(n,typeof e!="symbol"?e+"":e,i),i);import{U as _,_ as T,R as y}from"./vendor.5b22622a.js";import{f as P,c as D,l as V,g as z,h as C,i as S,p as N,m as U}from"./vec3.d4a804b7.js";/* empty css              */function F(n){let e=n.trim()+`
`;e.indexOf(`
`,0);let i=[1],u=[1],h=[1],r=[],a=[],g=[],d=[],v=0,E=e.split(`
`);for(let w=0;w<E.length;w++){let m=E[w];m=m.trim().replace(/\s+/g," ");let t=m.split(" ");const o=t[0];if(o==="v")t.shift(),t=t.map(parseFloat),i.push(t);else if(o==="vt")t.shift(),t=t.map(parseFloat),t[2]=0,u.push(t.slice(0,2));else if(o==="vn")t.shift(),t=t.map(parseFloat),h.push(t);else if(o==="f"){t.shift();for(let l=0;l<t.length-2;l++)for(let f=0;f<3;f++){let b=t[f+l];f==2&&(f=t.length-1,b=t[f]);let c=b.split("/");for(let x=0;x<3;x++)c[0]<0&&(c[0]=i.length+1+parseInt(c[0])),c[1]<0&&(c[1]=u.length+1+parseInt(c[1])),c[2]<0&&(c[2]=h.length+1+parseInt(c[2]));for(let x=0;x<c.length;x++)switch(x){case 0:r.push(i[c[0]]);break;case 1:a.push(u[c[1]]);break;case 2:g.push(h[c[2]]);break}d.push(v),v++}}}return{vertex:r,uv:a,normals:g,faces:d}}class O{constructor(){s(this,"objects",[])}add(e){this.objects.push(e)}getObjects(){return this.objects}}class R{constructor(e){s(this,"x",0);s(this,"y",0);s(this,"z",0);s(this,"rotX",0);s(this,"rotY",0);s(this,"rotZ",0);s(this,"fovy",2*Math.PI/5);s(this,"aspect",16/9);s(this,"near",.1);s(this,"far",1e3);s(this,"lookAt",P(0,0,0));this.aspect=e}getViewMatrix(){let e=D();return V(e,P(this.x,this.y,this.z),this.lookAt,P(0,1,0)),z(e,e,this.rotX),C(e,e,this.rotY),S(e,e,this.rotZ),e}getProjectionMatrix(){let e=D();return N(e,this.fovy,this.aspect,this.near,this.far),e}getCameraViewProjMatrix(){const e=D(),i=this.getViewMatrix(),u=this.getProjectionMatrix();return U(e,u,i),e}}let p;function Y(n){p=n}var A;function q(n){A=n}class X{constructor(){s(this,"adapter");s(this,"canvas");s(this,"context");s(this,"format");s(this,"devicePixelRatio",window.devicePixelRatio|1);s(this,"swapChainFormat","bgra8unorm");s(this,"renderPassDescriptor");s(this,"matrixSize",4*16);s(this,"presentationSize",[0,0])}async initEngine(e,i,u){this.canvas=e;let h=e.clientWidth*this.devicePixelRatio,r=e.clientHeight*this.devicePixelRatio;if(this.presentationSize=[h,r],!this.canvas)throw _.error("\u6CA1\u6709Canvas Element",10),new Error("\u6CA1\u6709Canvas Element");if(!navigator.gpu)throw _.error("\u4E0D\u652F\u6301\u4F7F\u7528\u663E\u5361\u8BBE\u5907",10),new Error("\u4E0D\u652F\u6301\u663E\u5361\u8BBE\u5907");if(this.adapter=await navigator.gpu.requestAdapter({powerPreference:i||"high-performance"})||void 0,!this.adapter)throw _.error("\u83B7\u53D6\u663E\u5361\u8BBE\u5907\u5931\u8D25",10),new Error("\u83B7\u53D6\u663E\u5361\u8BBE\u5907\u5931\u8D25");let a=await this.adapter.requestDevice();if(Y(a),!p)throw _.error("\u663E\u5361\u8BBE\u5907\u672A\u627E\u5230",10),new Error("\u663E\u5361\u8BBE\u5907\u672A\u627E\u5230");this.context=this.canvas.getContext("webgpu"),this.format=this.context.getPreferredFormat(this.adapter),u||(u={device:p,format:this.format,size:this.presentationSize,usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.context.configure(u);const g=this.depthTextureView();this.renderPassDescriptor={colorAttachments:[{view:void 0,loadOp:"clear",clearValue:{r:.5,g:.5,b:.5,a:1},storeOp:"store"}],depthStencilAttachment:{view:g,depthLoadOp:"clear",depthClearValue:10,depthStoreOp:"store",stencilLoadOp:"clear",stencilClearValue:0,stencilStoreOp:"store"}};let d=p.createBuffer({size:this.matrixSize,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});return q(d),!0}get device(){return p}depthTextureView(){return p.createTexture({size:this.presentationSize,format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT}).createView()}update(){this.renderPassDescriptor.depthStencilAttachment.view=this.depthTextureView()}frame(e,i){const u=e.getCameraViewProjMatrix();p.queue.writeBuffer(A,0,u.buffer,u.byteOffset,u.byteLength),this.renderPassDescriptor.colorAttachments[0].view=this.context.getCurrentTexture().createView();const h=p.createCommandEncoder(),r=h.beginRenderPass(this.renderPassDescriptor);for(let a of i.getObjects())a.draw(r,p);r.end(),p.queue.submit([h.finish()])}}const L="_part_pfhqm_1",k="_card_pfhqm_1",G="_footer_pfhqm_4";var H={part:L,card:k,footer:G},B="/Users/indeex/Documents/program/indeex/program/webGPU/wgsl-base/src/component/part11/index.tsx";const K=()=>{const[n,e]=T.exports.useState();T.exports.useEffect(()=>{i()},[]);const i=async(h=1)=>{const r=document.getElementById("gfx");r.width=document.body.clientWidth,r.height=document.body.clientHeight;const a=new R(r.width/r.height);a.z=30,a.y=15;const g=new O;e(g);const d=new X;await d.initEngine(r);let v={};await u(v,"./res/StylizedCharacter.obj"),await F(v.mesh);const E=()=>{d.frame(a,g),requestAnimationFrame(E)};E(),window.onresize=()=>{r.width=window.innerWidth,r.height=window.innerHeight,a.aspect=r.width/r.height,d.update()},r.onwheel=o=>{const l=o.deltaY/100;a.z>-l&&(a.z+=o.deltaY/100)};var w=!1;r.onmousedown=o=>{o.button===0&&(w=!0,m=o.pageX,t=o.pageY)},r.onmouseup=o=>{w=!1};var m=-1,t=-1;r.onmousemove=o=>{if(!!w){var l=o.pageX,f=o.pageY;if(m>0&&t>0){const b=l-m,c=f-t;a.rotY+=b/100,a.rotX+=c/100}m=l,t=f}},window.oncontextmenu=o=>{o.preventDefault();let l=Math.random();l<=.33&&i(1),l>.33&&l<=6.66&&i(2),l>.66&&i(3)}},u=async(h,r)=>{var a=new XMLHttpRequest;a.open("GET",r,!1),a.onload=()=>{a.status!=200?console.log("\u52A0\u8F7D"+a.status+": "+a.statusText):h.mesh=JSON.parse(a.responseText)},a.send()};return y.createElement("div",{className:H.part,__self:globalThis,__source:{fileName:B,lineNumber:110,columnNumber:10}},y.createElement("canvas",{id:"gfx",__self:globalThis,__source:{fileName:B,lineNumber:111,columnNumber:5}}))};export{K as default};
