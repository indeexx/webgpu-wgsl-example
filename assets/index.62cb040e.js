var P=Object.defineProperty;var b=(o,e,i)=>e in o?P(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i;var r=(o,e,i)=>(b(o,typeof e!="symbol"?e+"":e,i),i);import{_ as B,R as m}from"./vendor.5b22622a.js";import{c as u,p as _,t as V,r as y,m as M}from"./mat4.2a33baad.js";import{f as g}from"./vec3.c97a873f.js";const U="_part_pfhqm_1",A="_card_pfhqm_1",C="_footer_pfhqm_4";var R={part:U,card:A,footer:C},D=`struct Uniforms {
  modelViewProjectionMatrix : mat4x4<f32>;
};
@binding(0) @group(0) var<uniform> uniforms : Uniforms;

struct VertexOutput {
  @builtin(position) Position : vec4<f32>;
  @location(0) fragUV : vec2<f32>;
  @location(1) fragPosition: vec4<f32>;
};

@stage(vertex)
fn main(@location(0) position : vec4<f32>,
        @location(1) uv : vec2<f32>) -> VertexOutput {
  var output : VertexOutput;
  output.Position = uniforms.modelViewProjectionMatrix * position;
  output.fragUV = uv;
  output.fragPosition = 0.5 * (position + vec4<f32>(1.0, 1.0, 1.0, 1.0));
  return output;
}`,G=`@stage(fragment)
fn main(@location(0) fragUV: vec2<f32>,
        @location(1) fragPosition: vec4<f32>) -> @location(0) vec4<f32> {
  return fragPosition;
}`;const O=4*10,T=0,S=4*8,z=36,v=new Float32Array([1,-1,1,1,1,0,1,1,1,1,-1,-1,1,1,0,0,1,1,0,1,-1,-1,-1,1,0,0,0,1,0,0,1,-1,-1,1,1,0,0,1,1,0,1,-1,1,1,1,0,1,1,1,1,-1,-1,-1,1,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,0,1,1,0,1,1,-1,-1,1,1,0,0,1,0,0,1,1,-1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,0,0,1,0,0,-1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,-1,1,1,1,0,1,0,0,-1,1,-1,1,0,1,0,1,1,0,-1,1,1,1,0,1,1,1,1,1,1,1,-1,1,1,1,0,1,0,0,-1,-1,1,1,0,0,1,1,1,1,-1,1,1,1,0,1,1,1,0,1,-1,1,-1,1,0,1,0,1,0,0,-1,-1,-1,1,0,0,0,1,1,0,-1,-1,1,1,0,0,1,1,1,1,-1,1,-1,1,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,-1,1,1,1,0,1,1,1,0,1,-1,-1,1,1,0,0,1,1,0,0,-1,-1,1,1,0,0,1,1,0,0,1,-1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,-1,-1,1,1,0,0,1,1,1,-1,-1,-1,1,0,0,0,1,0,1,-1,1,-1,1,0,1,0,1,0,0,1,1,-1,1,1,1,0,1,1,0,1,-1,-1,1,1,0,0,1,1,1,-1,1,-1,1,0,1,0,1,0,0]);class N{constructor(e){r(this,"adapter");r(this,"device");r(this,"context");r(this,"format");r(this,"devicePixelRatio",window.devicePixelRatio|1);r(this,"size",[0,0]);r(this,"uniformBuffer");r(this,"renderPassDescriptor");r(this,"pipeline");r(this,"uniformBindGroup");r(this,"verticesBuffer");r(this,"projectionMatrix");r(this,"render",()=>{var a,n,s,c;const e=this.getTransformationMatrix();(a=this.device)==null||a.queue.writeBuffer(this.uniformBuffer,0,e.buffer,e.byteOffset,e.byteLength),this.renderPassDescriptor.colorAttachments[0].view=(n=this.context)==null?void 0:n.getCurrentTexture().createView();const i=(s=this.device)==null?void 0:s.createCommandEncoder(),t=i==null?void 0:i.beginRenderPass(this.renderPassDescriptor);t==null||t.setPipeline(this.pipeline),t==null||t.setBindGroup(0,this.uniformBindGroup),t==null||t.setVertexBuffer(0,this.verticesBuffer),t==null||t.draw(z,1,0,0),t.endPass?t.endPass():t==null||t.end(),(c=this.device)==null||c.queue.submit([i.finish()]),requestAnimationFrame(this.render)});this.canvas=e,this.canvas=e;let i=e.clientWidth*this.devicePixelRatio,t=e.clientHeight*this.devicePixelRatio;this.size=[i,t]}async start(){var e,i;if(!this.canvas)throw new Error("\u6CA1\u6709Canvas Element");if(!navigator.gpu)throw new Error("\u4E0D\u652F\u6301GPU");if(this.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"})||void 0,!this.adapter)throw new Error("\u83B7\u53D6\u8BBE\u5907\u5931\u8D25");if(this.device=await this.adapter.requestDevice(),!this.device)throw new Error("\u8BBE\u5907\u672A\u627E\u5230");this.context=this.canvas.getContext("webgpu"),this.format=(e=this.context)==null?void 0:e.getPreferredFormat(this.adapter),(i=this.context)==null||i.configure({device:this.device,format:this.format,size:this.size,compositingAlphaMode:"opaque"}),await this.init()}async init(){var d,h,l,p;const e=(d=this.device)==null?void 0:d.createBuffer({size:v.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});new Float32Array(e.getMappedRange()).set(v),e==null||e.unmap(),this.verticesBuffer=e;const i=(h=this.device)==null?void 0:h.createRenderPipeline({vertex:{module:this.device.createShaderModule({code:D}),entryPoint:"main",buffers:[{arrayStride:O,attributes:[{shaderLocation:0,offset:T,format:"float32x4"},{shaderLocation:1,offset:S,format:"float32x2"}]}]},fragment:{module:this.device.createShaderModule({code:G}),entryPoint:"main",targets:[{format:this.format}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}});this.pipeline=i;const t=(l=this.device)==null?void 0:l.createTexture({size:this.size,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),a=4*16,n=this.device.createBuffer({size:a,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.uniformBuffer=n;const s=(p=this.device)==null?void 0:p.createBindGroup({layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:n}}]});this.uniformBindGroup=s;const c={colorAttachments:[{view:void 0,loadValue:{r:.5,g:.5,b:.5,a:1},loadOp:"clear",storeOp:"store",clearValue:{r:.5,g:.5,b:.5,a:1}}],depthStencilAttachment:{view:t.createView(),depthClearValue:1,depthLoadValue:1,depthStoreOp:"store",depthLoadOp:"clear",stencilClearValue:0,stencilLoadValue:0,stencilStoreOp:"store"}};this.renderPassDescriptor=c;const f=u();this.projectionMatrix=f;const w=this.canvas.clientWidth/this.canvas.clientHeight;_(f,2*Math.PI/5,w,1,100),this.render()}getTransformationMatrix(){const e=u();V(e,e,g(0,0,-4));const i=Date.now()/1e3;y(e,e,1,g(Math.sin(i),Math.cos(i),0));const t=u();return M(t,this.projectionMatrix,e),t}}var x="/Users/indeex/Documents/program/indeex/program/webGPU/wgsl-base/src/component/part5/index.tsx";const F=()=>(B.exports.useEffect(()=>{const o=document.getElementById("gfx");o.width=document.body.clientWidth,o.height=document.body.clientHeight,new N(o).start(),window.onresize=function(){o.width=document.body.clientWidth,o.height=document.body.clientHeight}}),m.createElement("div",{className:R.part,__self:globalThis,__source:{fileName:x,lineNumber:17,columnNumber:10}},m.createElement("canvas",{id:"gfx",__self:globalThis,__source:{fileName:x,lineNumber:18,columnNumber:5}})));export{F as default};
